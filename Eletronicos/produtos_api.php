<?php
include 'config.php';
header('Content-Type: application/json');

try {
    // 1. Inserir dados de exemplo (se a tabela estiver vazia)
    $count = $pdo->query("SELECT COUNT(*) FROM produtos")->fetchColumn();
    if ($count == 0) {
        // O array de produtos ORIGINAL está no index.html. Precisamos inseri-lo.
        $produtos_json = '[{"id": 1, "nome": "Apple Smartphone Model 1", "categoria": "smartphones", "preco": 272, "marca": "Apple", "imagemURL": "https://via.placeholder.com/120?text=Prod+1"}, {"id": 2, "nome": "Samsung Smartphone Model 2", "categoria": "smartphones", "preco": 345, "marca": "Samsung", "imagemURL": "https://via.placeholder.com/120?text=Prod+2"}, {"id": 3, "nome": "Xiaomi Smartphone Model 3", "categoria": "smartphones", "preco": 418, "marca": "Xiaomi", "imagemURL": "https://via.placeholder.com/120?text=Prod+3"}, {"id": 4, "nome": "Motorola Smartphone Model 4", "categoria": "smartphones", "preco": 491, "marca": "Motorola", "imagemURL": "https://via.placeholder.com/120?text=Prod+4"}, {"id": 5, "nome": "Google Smartphone Model 5", "categoria": "smartphones", "preco": 564, "marca": "Google", "imagemURL": "https://via.placeholder.com/120?text=Prod+5"}, {"id": 6, "nome": "ASUS Smartphone Model 6", "categoria": "smartphones", "preco": 637, "marca": "ASUS", "imagemURL": "https://via.placeholder.com/120?text=Prod+6"}, {"id": 7, "nome": "Realme Smartphone Model 7", "categoria": "smartphones", "preco": 710, "marca": "Realme", "imagemURL": "https://via.placeholder.com/120?text=Prod+7"}, {"id": 8, "nome": "Apple Smartphone Model 8", "categoria": "smartphones", "preco": 783, "marca": "Apple", "imagemURL": "https://via.placeholder.com/120?text=Prod+8"}, {"id": 9, "nome": "Samsung Smartphone Model 9", "categoria": "smartphones", "preco": 856, "marca": "Samsung", "imagemURL": "https://via.placeholder.com/120?text=Prod+9"}, {"id": 10, "nome": "Xiaomi Smartphone Model 10", "categoria": "smartphones", "preco": 929, "marca": "Xiaomi", "imagemURL": "https://via.placeholder.com/120?text=Prod+10"}, {"id": 11, "nome": "Motorola Smartphone Model 11", "categoria": "smartphones", "preco": 1002, "marca": "Motorola", "imagemURL": "https://via.placeholder.com/120?text=Prod+11"}, {"id": 12, "nome": "Google Smartphone Model 12", "categoria": "smartphones", "preco": 1075, "marca": "Google", "imagemURL": "https://via.placeholder.com/120?text=Prod+12"}, {"id": 13, "nome": "ASUS Smartphone Model 13", "categoria": "smartphones", "preco": 1148, "marca": "ASUS", "imagemURL": "https://via.placeholder.com/120?text=Prod+13"}, {"id": 14, "nome": "Realme Smartphone Model 14", "categoria": "smartphones", "preco": 1221, "marca": "Realme", "imagemURL": "https://via.placeholder.com/120?text=Prod+14"}, {"id": 15, "nome": "Apple Smartphone Model 15", "categoria": "smartphones", "preco": 1294, "marca": "Apple", "imagemURL": "https://via.placeholder.com/120?text=Prod+15"}, {"id": 16, "nome": "Samsung Smartphone Model 16", "categoria": "smartphones", "preco": 1367, "marca": "Samsung", "imagemURL": "https://via.placeholder.com/120?text=Prod+16"}, {"id": 17, "nome": "Xiaomi Smartphone Model 17", "categoria": "smartphones", "preco": 1440, "marca": "Xiaomi", "imagemURL": "https://via.placeholder.com/120?text=Prod+17"}, {"id": 18, "nome": "Motorola Smartphone Model 18", "categoria": "smartphones", "preco": 1513, "marca": "Motorola", "imagemURL": "https://via.placeholder.com/120?text=Prod+18"}, {"id": 19, "nome": "Google Smartphone Model 19", "categoria": "smartphones", "preco": 1586, "marca": "Google", "imagemURL": "https://via.placeholder.com/120?text=Prod+19"}, {"id": 20, "nome": "ASUS Smartphone Model 20", "categoria": "smartphones", "preco": 1659, "marca": "ASUS", "imagemURL": "https://via.placeholder.com/120?text=Prod+20"}, {"id": 21, "nome": "Realme Smartphone Model 21", "categoria": "smartphones", "preco": 1732, "marca": "Realme", "imagemURL": "https://via.placeholder.com/120?text=Prod+21"}, {"id": 22, "nome": "Apple Smartphone Model 22", "categoria": "smartphones", "preco": 1805, "marca": "Apple", "imagemURL": "https://via.placeholder.com/120?text=Prod+22"}, {"id": 23, "nome": "Samsung Smartphone Model 23", "categoria": "smartphones", "preco": 1878, "marca": "Samsung", "imagemURL": "https://via.placeholder.com/120?text=Prod+23"}, {"id": 24, "nome": "Xiaomi Smartphone Model 24", "categoria": "smartphones", "preco": 1951, "marca": "Xiaomi", "imagemURL": "https://via.placeholder.com/120?text=Prod+24"}, {"id": 25, "nome": "Motorola Smartphone Model 25", "categoria": "smartphones", "preco": 2024, "marca": "Motorola", "imagemURL": "https://via.placeholder.com/120?text=Prod+25"}, {"id": 26, "nome": "Apple Notebook Model 1", "categoria": "notebooks", "preco": 2097, "marca": "Apple", "imagemURL": "https://via.placeholder.com/120?text=Prod+26"}, {"id": 27, "nome": "Dell Notebook Model 2", "categoria": "notebooks", "preco": 2170, "marca": "Dell", "imagemURL": "https://via.placeholder.com/120?text=Prod+27"}, {"id": 28, "nome": "ASUS Notebook Model 3", "categoria": "notebooks", "preco": 2243, "marca": "ASUS", "imagemURL": "https://via.placeholder.com/120?text=Prod+28"}, {"id": 29, "nome": "Lenovo Notebook Model 4", "categoria": "notebooks", "preco": 2316, "marca": "Lenovo", "imagemURL": "https://via.placeholder.com/120?text=Prod+29"}, {"id": 30, "nome": "Acer Notebook Model 5", "categoria": "notebooks", "preco": 2389, "marca": "Acer", "imagemURL": "https://via.placeholder.com/120?text=Prod+30"}, {"id": 31, "nome": "Samsung Notebook Model 6", "categoria": "notebooks", "preco": 2462, "marca": "Samsung", "imagemURL": "https://via.placeholder.com/120?text=Prod+31"}, {"id": 32, "nome": "Apple Notebook Model 7", "categoria": "notebooks", "preco": 2535, "marca": "Apple", "imagemURL": "https://via.placeholder.com/120?text=Prod+32"}, {"id": 33, "nome": "Dell Notebook Model 8", "categoria": "notebooks", "preco": 2608, "marca": "Dell", "imagemURL": "https://via.placeholder.com/120?text=Prod+33"}, {"id": 34, "nome": "ASUS Notebook Model 9", "categoria": "notebooks", "preco": 2681, "marca": "ASUS", "imagemURL": "https://via.placeholder.com/120?text=Prod+34"}, {"id": 35, "nome": "Lenovo Notebook Model 10", "categoria": "notebooks", "preco": 2754, "marca": "Lenovo", "imagemURL": "https://via.placeholder.com/120?text=Prod+35"}, {"id": 36, "nome": "Acer Notebook Model 11", "categoria": "notebooks", "preco": 2827, "marca": "Acer", "imagemURL": "https://via.placeholder.com/120?text=Prod+36"}, {"id": 37, "nome": "Samsung Notebook Model 12", "categoria": "notebooks", "preco": 2900, "marca": "Samsung", "imagemURL": "https://via.placeholder.com/120?text=Prod+37"}, {"id": 38, "nome": "Apple Notebook Model 13", "categoria": "notebooks", "preco": 2973, "marca": "Apple", "imagemURL": "https://via.placeholder.com/120?text=Prod+38"}, {"id": 39, "nome": "Dell Notebook Model 14", "categoria": "notebooks", "preco": 3046, "marca": "Dell", "imagemURL": "https://via.placeholder.com/120?text=Prod+39"}, {"id": 40, "nome": "ASUS Notebook Model 15", "categoria": "notebooks", "preco": 3119, "marca": "ASUS", "imagemURL": "https://via.placeholder.com/120?text=Prod+40"}, {"id": 41, "nome": "Lenovo Notebook Model 16", "categoria": "notebooks", "preco": 3192, "marca": "Lenovo", "imagemURL": "https://via.placeholder.com/120?text=Prod+41"}, {"id": 42, "nome": "Acer Notebook Model 17", "categoria": "notebooks", "preco": 3265, "marca": "Acer", "imagemURL": "https://via.placeholder.com/120?text=Prod+42"}, {"id": 43, "nome": "Samsung Notebook Model 18", "categoria": "notebooks", "preco": 3338, "marca": "Samsung", "imagemURL": "https://via.placeholder.com/120?text=Prod+43"}, {"id": 44, "nome": "Apple Notebook Model 19", "categoria": "notebooks", "preco": 3411, "marca": "Apple", "imagemURL": "https://via.placeholder.com/120?text=Prod+44"}, {"id": 45, "nome": "Dell Notebook Model 20", "categoria": "notebooks", "preco": 3484, "marca": "Dell", "imagemURL": "https://via.placeholder.com/120?text=Prod+45"}, {"id": 46, "nome": "ASUS Notebook Model 21", "categoria": "notebooks", "preco": 3557, "marca": "ASUS", "imagemURL": "https://via.placeholder.com/120?text=Prod+46"}, {"id": 47, "nome": "Lenovo Notebook Model 22", "categoria": "notebooks", "preco": 3630, "marca": "Lenovo", "imagemURL": "https://via.placeholder.com/120?text=Prod+47"}, {"id": 48, "nome": "Acer Notebook Model 23", "categoria": "notebooks", "preco": 3703, "marca": "Acer", "imagemURL": "https://via.placeholder.com/120?text=Prod+48"}, {"id": 49, "nome": "Samsung Notebook Model 24", "categoria": "notebooks", "preco": 3776, "marca": "Samsung", "imagemURL": "https://via.placeholder.com/120?text=Prod+49"}, {"id": 50, "nome": "Apple Notebook Model 25", "categoria": "notebooks", "preco": 3849, "marca": "Apple", "imagemURL": "https://via.placeholder.com/120?text=Prod+50"}, {"id": 51, "nome": "Apple Tablet Model 1", "categoria": "tablets", "preco": 3922, "marca": "Apple", "imagemURL": "https://via.placeholder.com/120?text=Prod+51"}, {"id": 52, "nome": "Samsung Tablet Model 2", "categoria": "tablets", "preco": 3995, "marca": "Samsung", "imagemURL": "https://via.placeholder.com/120?text=Prod+52"}, {"id": 53, "nome": "Xiaomi Tablet Model 3", "categoria": "tablets", "preco": 4068, "marca": "Xiaomi", "imagemURL": "https://via.placeholder.com/120?text=Prod+53"}, {"id": 54, "nome": "Lenovo Tablet Model 4", "categoria": "tablets", "preco": 4141, "marca": "Lenovo", "imagemURL": "https://via.placeholder.com/120?text=Prod+54"}, {"id": 55, "nome": "Microsoft Tablet Model 5", "categoria": "tablets", "preco": 4214, "marca": "Microsoft", "imagemURL": "https://via.placeholder.com/120?text=Prod+55"}, {"id": 56, "nome": "Amazon Tablet Model 6", "categoria": "tablets", "preco": 4287, "marca": "Amazon", "imagemURL": "https://via.placeholder.com/120?text=Prod+56"}, {"id": 57, "nome": "Apple Tablet Model 7", "categoria": "tablets", "preco": 4360, "marca": "Apple", "imagemURL": "https://via.placeholder.com/120?text=Prod+57"}, {"id": 58, "nome": "Samsung Tablet Model 8", "categoria": "tablets", "preco": 4433, "marca": "Samsung", "imagemURL": "https://via.placeholder.com/120?text=Prod+58"}, {"id": 59, "nome": "Xiaomi Tablet Model 9", "categoria": "tablets", "preco": 4506, "marca": "Xiaomi", "imagemURL": "https://via.placeholder.com/120?text=Prod+59"}, {"id": 60, "nome": "Lenovo Tablet Model 10", "categoria": "tablets", "preco": 4579, "marca": "Lenovo", "imagemURL": "https://via.placeholder.com/120?text=Prod+60"}, {"id": 61, "nome": "Microsoft Tablet Model 11", "categoria": "tablets", "preco": 4652, "marca": "Microsoft", "imagemURL": "https://via.placeholder.com/120?text=Prod+61"}, {"id": 62, "nome": "Amazon Tablet Model 12", "categoria": "tablets", "preco": 4725, "marca": "Amazon", "imagemURL": "https://via.placeholder.com/120?text=Prod+62"}, {"id": 63, "nome": "Apple Tablet Model 13", "categoria": "tablets", "preco": 4798, "marca": "Apple", "imagemURL": "https://via.placeholder.com/120?text=Prod+63"}, {"id": 64, "nome": "Samsung Tablet Model 14", "categoria": "tablets", "preco": 4871, "marca": "Samsung", "imagemURL": "https://via.placeholder.com/120?text=Prod+64"}, {"id": 65, "nome": "Xiaomi Tablet Model 15", "categoria": "tablets", "preco": 4944, "marca": "Xiaomi", "imagemURL": "https://via.placeholder.com/120?text=Prod+65"}, {"id": 66, "nome": "Lenovo Tablet Model 16", "categoria": "tablets", "preco": 5017, "marca": "Lenovo", "imagemURL": "https://via.placeholder.com/120?text=Prod+66"}, {"id": 67, "nome": "Microsoft Tablet Model 17", "categoria": "tablets", "preco": 5090, "marca": "Microsoft", "imagemURL": "https://via.placeholder.com/120?text=Prod+67"}, {"id": 68, "nome": "Amazon Tablet Model 18", "categoria": "tablets", "preco": 5163, "marca": "Amazon", "imagemURL": "https://via.placeholder.com/120?text=Prod+68"}, {"id": 69, "nome": "Apple Tablet Model 19", "categoria": "tablets", "preco": 5236, "marca": "Apple", "imagemURL": "https://via.placeholder.com/120?text=Prod+69"}, {"id": 70, "nome": "Samsung Tablet Model 20", "categoria": "tablets", "preco": 5309, "marca": "Samsung", "imagemURL": "https://via.placeholder.com/120?text=Prod+70"}, {"id": 71, "nome": "Xiaomi Tablet Model 21", "categoria": "tablets", "preco": 5382, "marca": "Xiaomi", "imagemURL": "https://via.placeholder.com/120?text=Prod+71"}, {"id": 72, "nome": "Lenovo Tablet Model 22", "categoria": "tablets", "preco": 5455, "marca": "Lenovo", "imagemURL": "https://via.placeholder.com/120?text=Prod+72"}, {"id": 73, "nome": "Microsoft Tablet Model 23", "categoria": "tablets", "preco": 5528, "marca": "Microsoft", "imagemURL": "https://via.placeholder.com/120?text=Prod+73"}, {"id": 74, "nome": "Amazon Tablet Model 24", "categoria": "tablets", "preco": 5601, "marca": "Amazon", "imagemURL": "https://via.placeholder.com/120?text=Prod+74"}, {"id": 75, "nome": "Apple Tablet Model 25", "categoria": "tablets", "preco": 5674, "marca": "Apple", "imagemURL": "https://via.placeholder.com/120?text=Prod+75"}, {"id": 76, "nome": "Apple Acessorio Model 1", "categoria": "acessorios", "preco": 5747, "marca": "Apple", "imagemURL": "https://via.placeholder.com/120?text=Prod+76"}, {"id": 77, "nome": "Anker Acessorio Model 2", "categoria": "acessorios", "preco": 5820, "marca": "Anker", "imagemURL": "https://via.placeholder.com/120?text=Prod+77"}, {"id": 78, "nome": "Logitech Acessorio Model 3", "categoria": "acessorios", "preco": 5893, "marca": "Logitech", "imagemURL": "https://via.placeholder.com/120?text=Prod+78"}, {"id": 79, "nome": "JBL Acessorio Model 4", "categoria": "acessorios", "preco": 5966, "marca": "JBL", "imagemURL": "https://via.placeholder.com/120?text=Prod+79"}, {"id": 80, "nome": "Sony Acessorio Model 5", "categoria": "acessorios", "preco": 6039, "marca": "Sony", "imagemURL": "https://via.placeholder.com/120?text=Prod+80"}, {"id": 81, "nome": "Baseus Acessorio Model 6", "categoria": "acessorios", "preco": 6112, "marca": "Baseus", "imagemURL": "https://via.placeholder.com/120?text=Prod+81"}, {"id": 82, "nome": "Razer Acessorio Model 7", "categoria": "acessorios", "preco": 6185, "marca": "Razer", "imagemURL": "https://via.placeholder.com/120?text=Prod+82"}, {"id": 83, "nome": "Apple Acessorio Model 8", "categoria": "acessorios", "preco": 6258, "marca": "Apple", "imagemURL": "https://via.placeholder.com/120?text=Prod+83"}, {"id": 84, "nome": "Anker Acessorio Model 9", "categoria": "acessorios", "preco": 6331, "marca": "Anker", "imagemURL": "https://via.placeholder.com/120?text=Prod+84"}, {"id": 85, "nome": "Logitech Acessorio Model 10", "categoria": "acessorios", "preco": 6404, "marca": "Logitech", "imagemURL": "https://via.placeholder.com/120?text=Prod+85"}, {"id": 86, "nome": "JBL Acessorio Model 11", "categoria": "acessorios", "preco": 6477, "marca": "JBL", "imagemURL": "https://via.placeholder.com/120?text=Prod+86"}, {"id": 87, "nome": "Sony Acessorio Model 12", "categoria": "acessorios", "preco": 6550, "marca": "Sony", "imagemURL": "https://via.placeholder.com/120?text=Prod+87"}, {"id": 88, "nome": "Baseus Acessorio Model 13", "categoria": "acessorios", "preco": 6623, "marca": "Baseus", "imagemURL": "https://via.placeholder.com/120?text=Prod+88"}, {"id": 89, "nome": "Razer Acessorio Model 14", "categoria": "acessorios", "preco": 6696, "marca": "Razer", "imagemURL": "https://via.placeholder.com/120?text=Prod+89"}, {"id": 90, "nome": "Apple Acessorio Model 15", "categoria": "acessorios", "preco": 6769, "marca": "Apple", "imagemURL": "https://via.placeholder.com/120?text=Prod+90"}, {"id": 91, "nome": "Anker Acessorio Model 16", "categoria": "acessorios", "preco": 6842, "marca": "Anker", "imagemURL": "https://via.placeholder.com/120?text=Prod+91"}, {"id": 92, "nome": "Logitech Acessorio Model 17", "categoria": "acessorios", "preco": 6915, "marca": "Logitech", "imagemURL": "https://via.placeholder.com/120?text=Prod+92"}, {"id": 93, "nome": "JBL Acessorio Model 18", "categoria": "acessorios", "preco": 6988, "marca": "JBL", "imagemURL": "https://via.placeholder.com/120?text=Prod+93"}, {"id": 94, "nome": "Sony Acessorio Model 19", "categoria": "acessorios", "preco": 7061, "marca": "Sony", "imagemURL": "https://via.placeholder.com/120?text=Prod+94"}, {"id": 95, "nome": "Baseus Acessorio Model 20", "categoria": "acessorios", "preco": 7134, "marca": "Baseus", "imagemURL": "https://via.placeholder.com/120?text=Prod+95"}, {"id": 96, "nome": "Razer Acessorio Model 21", "categoria": "acessorios", "preco": 7207, "marca": "Razer", "imagemURL": "https://via.placeholder.com/120?text=Prod+96"}, {"id": 97, "nome": "Apple Acessorio Model 22", "categoria": "acessorios", "preco": 7280, "marca": "Apple", "imagemURL": "https://via.placeholder.com/120?text=Prod+97"}, {"id": 98, "nome": "Anker Acessorio Model 23", "categoria": "acessorios", "preco": 7353, "marca": "Anker", "imagemURL": "https://via.placeholder.com/120?text=Prod+98"}, {"id": 99, "nome": "Logitech Acessorio Model 24", "categoria": "acessorios", "preco": 7426, "marca": "Logitech", "imagemURL": "https://via.placeholder.com/120?text=Prod+99"}, {"id": 100, "nome": "JBL Acessorio Model 25", "categoria": "acessorios", "preco": 7499, "marca": "JBL", "imagemURL": "https://via.placeholder.com/120?text=Prod+100"}]';
        $produtos = json_decode($produtos_json, true);
        
        $stmt_insert = $pdo->prepare("INSERT INTO produtos (id, nome, categoria, preco, marca, imagemURL) VALUES (?, ?, ?, ?, ?, ?)");

        foreach ($produtos as $p) {
            $stmt_insert->execute([$p['id'], $p['nome'], $p['categoria'], $p['preco'], $p['marca'], $p['imagemURL']]);
        }
    }

    // 2. Retorna todos os produtos
    $stmt = $pdo->query("SELECT id, nome, categoria, preco, marca, imagemURL FROM produtos ORDER BY id ASC");
    $produtos = $stmt->fetchAll();

    echo json_encode(['success' => true, 'produtos' => $produtos]);

} catch (\PDOException $e) {
    http_response_code(500);
    echo json_encode(['success' => false, 'message' => 'Erro ao buscar produtos: ' . $e->getMessage()]);
}
?>